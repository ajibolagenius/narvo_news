"use strict";(self.webpackChunknarvo_frontend=self.webpackChunknarvo_frontend||[]).push([[81],{8851(e,t,a){a.d(t,{T:()=>c});var r=a(9379),s=a(5043),o=a(1561);const n="https://african-news-hub-1.preview.emergentagent.com",l="narvo_bookmarks",c=()=>{const{user:e}=(0,o.A)(),[t,a]=(0,s.useState)([]),[c,i]=(0,s.useState)(!1),d=()=>{try{return JSON.parse(localStorage.getItem(l)||"[]")}catch(e){return[]}},m=e=>{localStorage.setItem(l,JSON.stringify(e))},x=(0,s.useCallback)(async()=>{if(e){i(!0);try{const t=await fetch("".concat(n,"/api/bookmarks?user_id=").concat(e.id));if(t.ok){const e=await t.json();a(e),m(e)}else a(d())}catch(t){a(d())}i(!1)}else a(d())},[e]);(0,s.useEffect)(()=>{x()},[x]);return{bookmarks:t,loading:c,addBookmark:async s=>{const o={story_id:s.id,title:s.title,summary:s.summary||"",source:s.source||"",category:s.category||"General",source_url:s.source_url||"",saved_at:(new Date).toISOString()},l=[...t.filter(e=>e.story_id!==s.id),o];if(a(l),m(l),e)try{await fetch("".concat(n,"/api/bookmarks"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,r.A)({user_id:e.id},o))})}catch(c){console.error("Failed to sync bookmark:",c)}},removeBookmark:async r=>{const s=t.filter(e=>e.story_id!==r);if(a(s),m(s),e)try{await fetch("".concat(n,"/api/bookmarks/").concat(r,"?user_id=").concat(e.id),{method:"DELETE"})}catch(o){console.error("Failed to remove bookmark:",o)}},isBookmarked:e=>t.some(t=>t.story_id===e),fetchBookmarks:x}}},5130(e,t,a){a.d(t,{at:()=>l,dZ:()=>n,zp:()=>o});const r="audio_files";function s(){return new Promise((e,t)=>{const a=indexedDB.open("narvo_audio_cache",1);a.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(r)||t.createObjectStore(r,{keyPath:"story_id"})},a.onsuccess=t=>e(t.target.result),a.onerror=e=>t(e.target.error)})}async function o(e){try{const t=(await s()).transaction(r,"readonly"),a=t.objectStore(r).get(e);return new Promise(e=>{a.onsuccess=()=>{var t;return e((null===(t=a.result)||void 0===t?void 0:t.audio_url)||null)},a.onerror=()=>e(null)})}catch(t){return null}}async function n(e){try{const t=(await s()).transaction(r,"readwrite");return t.objectStore(r).delete(e),new Promise(e=>{t.oncomplete=()=>e(!0),t.onerror=()=>e(!1)})}catch(t){return!1}}async function l(){try{const e=(await s()).transaction(r,"readonly"),t=e.objectStore(r).getAllKeys();return new Promise(e=>{t.onsuccess=()=>e(t.result||[]),t.onerror=()=>e([])})}catch(e){return[]}}},9081(e,t,a){a.r(t),a.d(t,{default:()=>f});var r=a(5043),s=a(5475),o=a(3216),n=a(3988),l=a(8851),c=a(5130),i=a(7980),d=a(8967),m=a(7505),x=a(1739),p=a(6381),u=a(7302),h=a(579);const f=()=>{const e=(0,o.Zp)(),{playTrack:t,currentTrack:a,isPlaying:f}=(0,n.n)(),{bookmarks:g,loading:y}=(0,l.T)(),{removeBookmark:b}=(0,l.T)(),[k,v]=(0,r.useState)([]);(0,r.useEffect)(()=>{(0,c.at)().then(v)},[]);const N=e=>k.includes(e);return(0,h.jsxs)("main",{className:"flex-1 flex flex-col bg-background-dark min-w-0","data-testid":"bookmarks-page",children:[(0,h.jsxs)("div",{className:"h-12 md:h-14 flex items-center justify-between px-4 md:px-8 bg-surface/30 narvo-border-b shrink-0",children:[(0,h.jsxs)("span",{className:"mono-ui text-[10px] md:text-xs text-forest",children:["MODULE: ",(0,h.jsx)("span",{className:"text-primary",children:"SAVED_TRANSMISSIONS"})]}),(0,h.jsxs)("span",{className:"mono-ui text-[10px] md:text-xs text-forest",children:[g.length," ITEMS"]})]}),(0,h.jsx)("div",{className:"flex-1 overflow-y-auto custom-scroll p-4 md:p-8 pb-20 md:pb-8",children:(0,h.jsx)("div",{className:"max-w-4xl mx-auto",children:y?(0,h.jsx)(u._N,{count:3}):(0,h.jsxs)(h.Fragment,{children:[g.length>0&&(0,h.jsxs)("div",{className:"narvo-border bg-surface/20 p-3 md:p-4 mb-6 md:mb-8 flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4",children:[(0,h.jsxs)("div",{className:"flex items-center gap-3",children:[(0,h.jsx)("div",{className:"w-2 h-2 bg-primary animate-pulse"}),(0,h.jsxs)("span",{className:"mono-ui text-[9px] md:text-[10px] text-forest",children:["OFFLINE_CACHE: ",(0,h.jsxs)("span",{className:"text-primary",children:[k.filter(e=>g.some(t=>t.story_id===e)).length," / ",g.length]})]})]}),(0,h.jsx)("span",{className:"mono-ui text-[8px] md:text-[9px] text-forest/50 sm:ml-auto",children:"Play to cache audio"})]}),0===g.length?(0,h.jsxs)("div",{className:"narvo-border bg-surface/20 p-8 md:p-12 text-center",children:[(0,h.jsx)(i.X,{className:"w-10 h-10 md:w-12 md:h-12 text-forest mx-auto mb-3 md:mb-4"}),(0,h.jsx)("h3",{className:"font-display text-lg md:text-xl text-content mb-2 uppercase",children:"No Saved Stories"}),(0,h.jsx)("p",{className:"text-forest text-xs md:text-sm mb-4 md:mb-6 font-mono",children:"Bookmark stories to access them offline."}),(0,h.jsx)(s.N_,{to:"/dashboard",className:"bg-primary text-background-dark font-display font-bold px-4 md:px-6 py-2 md:py-3 text-sm md:text-base hover:bg-white transition-all inline-block","data-testid":"go-to-feed-btn",children:"[Go to Feed]"})]}):(0,h.jsx)("div",{className:"narvo-border bg-surface/20 divide-y divide-forest/10","data-testid":"bookmarks-list",children:g.map(r=>{var s;return(0,h.jsx)("div",{className:"p-4 md:p-6 group hover:bg-surface/40 transition-colors cursor-pointer",onClick:()=>e("/news/".concat(r.story_id)),"data-testid":"bookmark-card-".concat(r.story_id),children:(0,h.jsxs)("div",{className:"flex flex-col gap-2 md:gap-3",children:[(0,h.jsxs)("div",{className:"flex flex-wrap justify-between items-start gap-2",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2 md:gap-3",children:[(0,h.jsx)("span",{className:"bg-forest/20 text-primary mono-ui text-[8px] md:text-[9px] px-1.5 md:px-2 py-0.5 border border-forest/30",children:null===(s=r.category)||void 0===s?void 0:s.toUpperCase()}),N(r.story_id)&&(0,h.jsxs)("span",{className:"mono-ui text-[7px] md:text-[8px] text-forest flex items-center gap-1 border border-forest/30 px-1 md:px-1.5 py-0.5","data-testid":"cached-badge-".concat(r.story_id),children:[(0,h.jsx)(d.J,{className:"w-2.5 h-2.5 md:w-3 md:h-3"})," CACHED"]})]}),(0,h.jsx)("span",{className:"mono-ui text-[7px] md:text-[8px] text-forest/50",children:r.source})]}),(0,h.jsx)("h3",{className:"font-display text-base md:text-xl font-bold uppercase tracking-tight text-content group-hover:text-primary transition-colors leading-tight",children:r.title}),(0,h.jsx)("p",{className:"text-xs md:text-sm text-forest font-mono leading-relaxed opacity-70 line-clamp-2",children:r.summary}),(0,h.jsxs)("div",{className:"flex items-center gap-3 md:gap-6 pt-1",children:[(0,h.jsxs)("button",{onClick:e=>{e.stopPropagation(),t({id:r.story_id,title:r.title,summary:r.summary,source:r.source})},className:"mono-ui text-[9px] md:text-[10px] text-primary flex items-center gap-2 hover:text-content transition-colors","data-testid":"play-bookmark-".concat(r.story_id),children:[(null===a||void 0===a?void 0:a.id)===r.story_id&&f?(0,h.jsx)(m.v,{className:"w-4 h-4"}):(0,h.jsx)(x.j,{className:"w-4 h-4"}),(0,h.jsx)("span",{className:"hidden sm:inline",children:N(r.story_id)?"PLAY_OFFLINE":"GENERATE_AUDIO"}),(0,h.jsx)("span",{className:"sm:hidden",children:"PLAY"})]}),(0,h.jsx)("div",{className:"flex-1 h-[1px] bg-forest/10 hidden md:block"}),(0,h.jsxs)("span",{className:"mono-ui text-[7px] md:text-[8px] text-forest/50 hidden md:inline",children:["SAVED: ",new Date(r.saved_at).toLocaleDateString()]}),(0,h.jsx)("button",{onClick:e=>{e.stopPropagation(),(async e=>{b(e),await(0,c.dZ)(e),v(t=>t.filter(t=>t!==e))})(r.story_id)},className:"text-forest hover:text-red-400 transition-colors ml-auto md:ml-0","data-testid":"remove-bookmark-".concat(r.story_id),children:(0,h.jsx)(p.l,{className:"w-4 h-4"})})]})]})},r.story_id)})})]})})})]})}},7980(e,t,a){a.d(t,{X:()=>c});var r=a(9379),s=a(5043),o=a(6667);const n=new Map([["bold",s.createElement(s.Fragment,null,s.createElement("path",{d:"M184,28H72A20,20,0,0,0,52,48V224a12,12,0,0,0,18.36,10.18l57.63-36,57.65,36A12,12,0,0,0,204,224V48A20,20,0,0,0,184,28Zm-4,24V154.35l-45.65-28.53a12,12,0,0,0-12.72,0L76,154.35V52ZM134.35,173.82a12,12,0,0,0-12.72,0L76,202.35v-19.7l52-32.5,52,32.5v19.7Z"}))],["duotone",s.createElement(s.Fragment,null,s.createElement("path",{d:"M192,176v48l-64-40L64,224V176l64-40Z",opacity:"0.2"}),s.createElement("path",{d:"M184,32H72A16,16,0,0,0,56,48V224a8,8,0,0,0,12.24,6.78L128,193.43l59.77,37.35A8,8,0,0,0,200,224V48A16,16,0,0,0,184,32Zm0,16V161.57l-51.77-32.35a8,8,0,0,0-8.48,0L72,161.56V48ZM132.23,177.22a8,8,0,0,0-8.48,0L72,209.57V180.43l56-35,56,35v29.14Z"}))],["fill",s.createElement(s.Fragment,null,s.createElement("path",{d:"M184,32H72A16,16,0,0,0,56,48V224a8,8,0,0,0,12.24,6.78L128,193.43l59.77,37.35A8,8,0,0,0,200,224V48A16,16,0,0,0,184,32ZM132.23,177.22a8,8,0,0,0-8.48,0L72,209.57V180.43l56-35,56,35v29.14Z"}))],["light",s.createElement(s.Fragment,null,s.createElement("path",{d:"M184,34H72A14,14,0,0,0,58,48V224a6,6,0,0,0,9.18,5.09l60.81-38,60.83,38A6,6,0,0,0,198,224V48A14,14,0,0,0,184,34ZM72,46H184a2,2,0,0,1,2,2V165.18l-54.83-34.27a6,6,0,0,0-6.36,0L70,165.17V48A2,2,0,0,1,72,46Zm59.17,132.91a6,6,0,0,0-6.36,0L70,213.17V179.33l58-36.25,58,36.25v33.84Z"}))],["regular",s.createElement(s.Fragment,null,s.createElement("path",{d:"M184,32H72A16,16,0,0,0,56,48V224a8,8,0,0,0,12.24,6.78L128,193.43l59.77,37.35A8,8,0,0,0,200,224V48A16,16,0,0,0,184,32Zm0,16V161.57l-51.77-32.35a8,8,0,0,0-8.48,0L72,161.56V48ZM132.23,177.22a8,8,0,0,0-8.48,0L72,209.57V180.43l56-35,56,35v29.14Z"}))],["thin",s.createElement(s.Fragment,null,s.createElement("path",{d:"M184,36H72A12,12,0,0,0,60,48V224a4,4,0,0,0,6.12,3.39L128,188.72l61.89,38.67A4,4,0,0,0,192,228a4.06,4.06,0,0,0,1.94-.5A4,4,0,0,0,196,224V48A12,12,0,0,0,184,36ZM72,44H184a4,4,0,0,1,4,4V168.78l-57.89-36.17a4,4,0,0,0-4.24,0L68,168.78V48A4,4,0,0,1,72,44Zm58.11,136.61a4,4,0,0,0-4.24,0L68,216.78V178.22l60-37.5,60,37.5v38.56Z"}))]]),l=s.forwardRef((e,t)=>s.createElement(o.A,(0,r.A)((0,r.A)({ref:t},e),{},{weights:n})));l.displayName="BookmarkIcon";const c=l},8967(e,t,a){a.d(t,{J:()=>c});var r=a(9379),s=a(5043),o=a(6667);const n=new Map([["bold",s.createElement(s.Fragment,null,s.createElement("path",{d:"M232.49,80.49l-128,128a12,12,0,0,1-17,0l-56-56a12,12,0,1,1,17-17L96,183,215.51,63.51a12,12,0,0,1,17,17Z"}))],["duotone",s.createElement(s.Fragment,null,s.createElement("path",{d:"M232,56V200a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V56A16,16,0,0,1,40,40H216A16,16,0,0,1,232,56Z",opacity:"0.2"}),s.createElement("path",{d:"M205.66,85.66l-96,96a8,8,0,0,1-11.32,0l-40-40a8,8,0,0,1,11.32-11.32L104,164.69l90.34-90.35a8,8,0,0,1,11.32,11.32Z"}))],["fill",s.createElement(s.Fragment,null,s.createElement("path",{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM205.66,85.66l-96,96a8,8,0,0,1-11.32,0l-40-40a8,8,0,0,1,11.32-11.32L104,164.69l90.34-90.35a8,8,0,0,1,11.32,11.32Z"}))],["light",s.createElement(s.Fragment,null,s.createElement("path",{d:"M228.24,76.24l-128,128a6,6,0,0,1-8.48,0l-56-56a6,6,0,0,1,8.48-8.48L96,191.51,219.76,67.76a6,6,0,0,1,8.48,8.48Z"}))],["regular",s.createElement(s.Fragment,null,s.createElement("path",{d:"M229.66,77.66l-128,128a8,8,0,0,1-11.32,0l-56-56a8,8,0,0,1,11.32-11.32L96,188.69,218.34,66.34a8,8,0,0,1,11.32,11.32Z"}))],["thin",s.createElement(s.Fragment,null,s.createElement("path",{d:"M226.83,74.83l-128,128a4,4,0,0,1-5.66,0l-56-56a4,4,0,0,1,5.66-5.66L96,194.34,221.17,69.17a4,4,0,1,1,5.66,5.66Z"}))]]),l=s.forwardRef((e,t)=>s.createElement(o.A,(0,r.A)((0,r.A)({ref:t},e),{},{weights:n})));l.displayName="CheckIcon";const c=l}}]);
//# sourceMappingURL=81.ce0a03b7.chunk.js.map