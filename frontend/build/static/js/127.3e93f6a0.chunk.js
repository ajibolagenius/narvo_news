"use strict";(self.webpackChunknarvo_frontend=self.webpackChunknarvo_frontend||[]).push([[127],{7302(e,t,a){a.d(t,{Ay:()=>o,Oi:()=>r,_N:()=>n,c$:()=>i,if:()=>c});a(5043);var s=a(579);const l=e=>{let{className:t="",variant:a="rect"}=e;const l="animate-pulse bg-forest/10";return"circle"===a?(0,s.jsx)("div",{className:"".concat(l," rounded-full ").concat(t)}):"text"===a?(0,s.jsx)("div",{className:"".concat(l," h-4 ").concat(t)}):(0,s.jsx)("div",{className:"".concat(l," ").concat(t)})},i=()=>(0,s.jsxs)("div",{className:"narvo-border bg-surface/30 flex flex-col md:flex-row min-h-[320px]",children:[(0,s.jsx)("div",{className:"md:w-1/2 bg-forest/5 min-h-[200px]"}),(0,s.jsxs)("div",{className:"flex-1 p-8 flex flex-col justify-between gap-4",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(l,{variant:"text",className:"w-40 h-3"}),(0,s.jsx)(l,{variant:"text",className:"w-full h-8"}),(0,s.jsx)(l,{variant:"text",className:"w-3/4 h-8"}),(0,s.jsx)(l,{variant:"text",className:"w-full h-4 mt-4"}),(0,s.jsx)(l,{variant:"text",className:"w-2/3 h-4"})]}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)(l,{className:"flex-1 h-12"}),(0,s.jsx)(l,{className:"w-12 h-12"}),(0,s.jsx)(l,{className:"w-12 h-12"})]})]})]}),r=()=>(0,s.jsxs)("div",{className:"p-6 narvo-border-b",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(l,{variant:"text",className:"w-24 h-4"}),(0,s.jsx)(l,{variant:"text",className:"w-14 h-4"})]}),(0,s.jsx)(l,{variant:"text",className:"w-20 h-4"})]}),(0,s.jsx)(l,{variant:"text",className:"w-full h-6 mb-2"}),(0,s.jsx)(l,{variant:"text",className:"w-3/4 h-6 mb-3"}),(0,s.jsx)(l,{variant:"text",className:"w-full h-4"}),(0,s.jsx)(l,{variant:"text",className:"w-2/3 h-4 mt-1"})]}),c=()=>(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(l,{className:"w-20 h-6"}),(0,s.jsx)(l,{className:"w-20 h-6"})]}),(0,s.jsx)(l,{variant:"text",className:"w-full h-12"}),(0,s.jsx)(l,{variant:"text",className:"w-4/5 h-12"}),(0,s.jsxs)("div",{className:"border-l-2 border-forest/20 pl-6 space-y-2",children:[(0,s.jsx)(l,{variant:"text",className:"w-full h-5"}),(0,s.jsx)(l,{variant:"text",className:"w-3/4 h-5"})]}),(0,s.jsx)(l,{className:"w-full h-[400px]"}),(0,s.jsx)(l,{className:"w-full h-16"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(l,{variant:"text",className:"w-full h-4"}),(0,s.jsx)(l,{variant:"text",className:"w-full h-4"}),(0,s.jsx)(l,{variant:"text",className:"w-2/3 h-4"})]})]}),n=e=>{let{count:t=4}=e;return(0,s.jsx)("div",{className:"narvo-border bg-surface/20 divide-y divide-forest/10",children:Array.from({length:t}).map((e,t)=>(0,s.jsx)(r,{},t))})},o=l},2127(e,t,a){a.r(t),a.d(t,{default:()=>w});var s=a(5043),l=a(3216),i=a(4547),r=a(6888),c=a(1042),n=a(9082),o=a(8899),d=a(3069),x=a(7505),m=a(1739),p=a(3654),h=a(6381),f=a(3579),u=a(1477),j=a(9659),N=a(3988),v=a(5130),y=a(7302),g=a(579);const b="http://localhost:8000",w=()=>{const e=(0,l.Zp)(),[t,a]=(0,s.useState)([]),[w,k]=(0,s.useState)([]),[A,E]=(0,s.useState)(!0),[C,_]=(0,s.useState)("all"),[S,I]=(0,s.useState)({totalSize:0,formattedSize:"0 KB",offlineReady:0}),[T,O]=(0,s.useState)(1),[,L]=(0,s.useState)({article_count:0}),{playTrack:R,currentTrack:D,isPlaying:G,togglePlay:M}=(0,N.n)();(0,s.useEffect)(()=>{z()},[]);const z=async()=>{E(!0),await Promise.all([F(),P(),B()]),E(!1)},B=async()=>{try{const e=await fetch("".concat(b,"/api/offline/stats"));if(e.ok){const t=await e.json();L(t)}}catch(e){console.error("Error loading offline stats:",e)}},P=async()=>{try{const e=await fetch("".concat(b,"/api/offline/articles"));if(e.ok){const t=await e.json();k(t.map(e=>({id:e.story_id,title:e.title||"Article_".concat(e.story_id.slice(0,8)),metadata:"".concat(e.source||"SAVED"," // ").concat(e.category||"GENERAL"),duration:"--:--",size:0,type:"article",timestamp:e.saved_at||Date.now(),status:"complete",narrative:e.narrative,summary:e.summary,image_url:e.image_url})))}}catch(e){console.error("Error loading saved articles:",e)}},F=async()=>{try{const e=await(0,v.ON)(),t=await(0,v.QS)();a(e.map(e=>({id:e.id,title:e.title||"Audio_".concat(e.id.slice(0,8)),metadata:e.source||"CACHED",duration:e.duration||"--:--",size:e.size||0,type:e.type||"audio",timestamp:e.cached_at,status:e.hasBlob?"complete":"url_only",hasBlob:e.hasBlob}))),I(t)}catch(e){console.error("Error loading cached items:",e)}},H=e=>{if(!e||isNaN(e))return"--:--";const t=Math.floor(e/60),a=Math.floor(e%60);return"".concat(t,":").concat(a.toString().padStart(2,"0"))},V=[...t,...w],K=S.totalSize/53687091200*100,U="all"===C?V:"audio"===C?t:"article"===C?w:V.filter(e=>e.type===C),Y=Math.ceil(U.length/6),Z=U.slice(6*(T-1),6*T);return(0,g.jsxs)("main",{className:"flex-1 overflow-y-auto overflow-x-hidden custom-scroll p-4 md:p-10 space-y-8 md:space-y-12 max-w-7xl mx-auto w-full pb-32 md:pb-10 min-h-0","data-testid":"offline-page",children:[(0,g.jsxs)("section",{className:"space-y-6 md:space-y-8",children:[(0,g.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4 md:gap-6",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsxs)("div",{className:"flex items-center gap-2 text-primary",children:[(0,g.jsx)(n.Bm,{className:"w-4 h-4"}),(0,g.jsx)("span",{className:"mono-ui text-[11px] md:text-[12px] font-bold tracking-[0.2em]",children:"LOCAL_STORAGE_INDEX"})]}),(0,g.jsxs)("h2",{className:"font-display text-3xl md:text-5xl font-bold uppercase tracking-tight text-content leading-none",children:["Cached ",(0,g.jsx)("span",{className:"text-primary",children:"Archives."})]}),S.offlineReady>0&&(0,g.jsxs)("div",{className:"flex items-center gap-2 text-forest mono-ui text-[11px]",children:[(0,g.jsx)(c.r,{weight:"fill",className:"w-3 h-3 text-green-500"}),(0,g.jsxs)("span",{children:[S.offlineReady," items ready for offline"]})]})]}),(0,g.jsxs)("div",{className:"flex flex-col items-start md:items-end mono-ui text-[11px] md:text-[12px]",children:[(0,g.jsx)("span",{className:"text-forest tracking-wider mb-1 md:mb-2 font-bold",children:"CAPACITY_LIMIT"}),(0,g.jsxs)("div",{className:"text-content text-base md:text-lg",children:[S.formattedSize," ",(0,g.jsx)("span",{className:"text-forest",children:"/ 50.0 GB"})]})]})]}),(0,g.jsx)("div",{className:"relative w-full h-2 md:h-3 narvo-border p-[1px] bg-surface/20",children:(0,g.jsx)("div",{className:"h-full bg-primary transition-all duration-500",style:{width:"".concat(Math.min(K,100),"%")}})}),(0,g.jsxs)("div",{className:"flex justify-between mono-ui text-[10px] md:text-[11px] text-forest font-bold",children:[(0,g.jsx)("span",{children:"00.0%"}),(0,g.jsxs)("span",{className:"text-primary",children:[K.toFixed(1),"% // ACTIVE_USAGE"]}),(0,g.jsx)("span",{children:"100.0%"})]})]}),(0,g.jsxs)("section",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 md:gap-6 py-4 md:py-6 narvo-border-b border-forest/30",children:[(0,g.jsxs)("div",{className:"flex flex-wrap items-center gap-3 md:gap-4",children:[(0,g.jsxs)("button",{className:"flex items-center gap-2 md:gap-3 narvo-border px-4 md:px-6 py-2 mono-ui text-[11px] md:text-[12px] font-bold text-content hover:bg-primary hover:text-background-dark transition-all group",children:[(0,g.jsx)(o.r,{className:"w-4 h-4"}),(0,g.jsx)("span",{children:"FILTER"})]}),(0,g.jsx)("div",{className:"h-4 w-px bg-forest/30 hidden sm:block"}),(0,g.jsxs)("div",{className:"flex items-center gap-1 md:gap-2",children:[(0,g.jsxs)("button",{onClick:()=>_("all"),className:"px-3 md:px-4 py-1 md:py-1.5 mono-ui text-[11px] md:text-[12px] font-bold ".concat("all"===C?"bg-primary text-background-dark":"text-forest hover:text-content transition-colors"),"data-testid":"filter-all",children:["ALL (",V.length,")"]}),(0,g.jsxs)("button",{onClick:()=>_("audio"),className:"px-3 md:px-4 py-1 md:py-1.5 mono-ui text-[11px] md:text-[12px] font-bold ".concat("audio"===C?"bg-primary text-background-dark":"text-forest hover:text-content transition-colors"),"data-testid":"filter-audio",children:["AUDIO (",t.length,")"]}),(0,g.jsxs)("button",{onClick:()=>_("article"),className:"px-3 md:px-4 py-1 md:py-1.5 mono-ui text-[11px] md:text-[12px] font-bold ".concat("article"===C?"bg-primary text-background-dark":"text-forest hover:text-content transition-colors"),"data-testid":"filter-article",children:["ARTICLES (",w.length,")"]})]})]}),(0,g.jsxs)("button",{onClick:async()=>{await(0,v.pc)();try{await fetch("".concat(b,"/api/offline/articles"),{method:"DELETE"})}catch(e){console.error("Error clearing articles:",e)}await z()},className:"flex items-center gap-2 mono-ui text-[11px] md:text-[12px] font-bold text-forest hover:text-primary transition-colors","data-testid":"clear-cache-btn",children:[(0,g.jsx)(h.l,{className:"w-4 h-4"}),(0,g.jsx)("span",{children:"CLEAR_LOCAL_CACHE"})]})]}),(0,g.jsxs)("section",{className:"narvo-border bg-surface/5",children:[(0,g.jsxs)("div",{className:"grid grid-cols-12 gap-3 md:gap-6 px-4 md:px-6 py-3 md:py-4 narvo-border-b bg-surface/30 mono-ui text-[11px] md:text-[12px] text-forest font-bold",children:[(0,g.jsx)("div",{className:"col-span-1 text-center",children:"SIG"}),(0,g.jsx)("div",{className:"col-span-11 md:col-span-5",children:"FILE_IDENTIFIER"}),(0,g.jsx)("div",{className:"col-span-2 hidden md:block text-right",children:"DURATION"}),(0,g.jsx)("div",{className:"col-span-2 hidden md:block text-right",children:"STORAGE_SIZE"}),(0,g.jsx)("div",{className:"col-span-2 text-right",children:"ACTION"})]}),(0,g.jsx)("div",{className:"divide-y divide-forest/10",children:A?Array.from({length:4}).map((e,t)=>(0,g.jsxs)("div",{className:"grid grid-cols-12 gap-3 md:gap-6 px-4 md:px-6 py-4 md:py-5 items-center",children:[(0,g.jsx)("div",{className:"col-span-1 flex justify-center",children:(0,g.jsx)(y.Ay,{className:"w-5 h-5"})}),(0,g.jsxs)("div",{className:"col-span-11 md:col-span-5 flex flex-col gap-1",children:[(0,g.jsx)(y.Ay,{variant:"text",className:"w-48 h-4"}),(0,g.jsx)(y.Ay,{variant:"text",className:"w-32 h-3"})]}),(0,g.jsx)("div",{className:"col-span-2 hidden md:block text-right",children:(0,g.jsx)(y.Ay,{variant:"text",className:"w-12 h-3 ml-auto"})}),(0,g.jsx)("div",{className:"col-span-2 hidden md:block text-right",children:(0,g.jsx)(y.Ay,{variant:"text",className:"w-16 h-3 ml-auto"})})]},t)):0===Z.length?(0,g.jsxs)("div",{className:"p-8 md:p-12 relative overflow-hidden min-h-[300px] flex items-center justify-center","data-testid":"offline-empty-state",children:[(0,g.jsx)("div",{className:"absolute inset-0 opacity-10 pointer-events-none",style:{backgroundImage:"linear-gradient(#628141 1px, transparent 1px), linear-gradient(90deg, #628141 1px, transparent 1px)",backgroundSize:"40px 40px"}}),(0,g.jsxs)("div",{className:"bg-background-dark narvo-border p-6 md:p-10 max-w-md w-full text-center shadow-xl backdrop-blur-md relative z-10",children:[(0,g.jsx)("div",{className:"mb-4 md:mb-6 flex justify-center",children:(0,g.jsx)("div",{className:"w-16 h-16 md:w-20 md:h-20 bg-surface narvo-border border-dashed flex items-center justify-center relative",children:(0,g.jsx)(j.l,{className:"w-8 h-8 md:w-10 md:h-10 text-forest"})})}),(0,g.jsx)("h3",{className:"font-display text-xl md:text-2xl font-bold text-content mb-3 uppercase tracking-tighter",children:"NO CACHED DATA"}),(0,g.jsx)("p",{className:"text-forest text-xs md:text-sm mono-ui leading-relaxed mb-6 lowercase",children:"No offline content is available. Play stories while online to automatically cache audio for offline listening."}),(0,g.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,g.jsxs)("button",{onClick:()=>e("/dashboard"),className:"h-10 md:h-12 px-5 md:px-6 bg-primary text-background-dark font-bold mono-ui text-[11px] md:text-[12px] hover:bg-white transition-all flex items-center justify-center gap-2",children:[(0,g.jsx)(i.o,{className:"w-4 h-4"}),"GO ONLINE"]}),(0,g.jsx)("button",{onClick:()=>e("/settings"),className:"h-10 md:h-12 px-5 md:px-6 narvo-border text-primary font-bold mono-ui text-[11px] md:text-[12px] hover:bg-primary hover:text-background-dark transition-all",children:"MANAGE STORAGE"})]}),(0,g.jsxs)("div",{className:"mt-6 pt-4 narvo-border-t flex justify-between items-center text-[9px] md:text-[10px] mono-ui font-bold text-forest",children:[(0,g.jsx)("span",{children:"ERR_CODE: 0x00_CACHE_EMPTY"}),(0,g.jsx)("span",{children:"NARVO_SYS_V2.6"})]})]})]}):Z.map((e,t)=>{const a=(null===D||void 0===D?void 0:D.id)===e.id&&G,s="corrupted"===e.status;return(0,g.jsxs)("div",{className:"grid grid-cols-12 gap-3 md:gap-6 px-4 md:px-6 py-4 md:py-5 items-center transition-colors group cursor-pointer relative overflow-hidden\n                    ".concat(a?"bg-primary/5":s?"opacity-40 hover:opacity-100 cursor-not-allowed":"hover:bg-surface/20","\n                  "),"data-testid":"cached-item-".concat(e.id),children:[a&&(0,g.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary"}),(0,g.jsx)("div",{className:"col-span-1 flex justify-center ".concat(a?"text-primary animate-pulse":s?"text-primary/50":"text-primary"),children:s?(0,g.jsx)(f.Q,{className:"w-4 h-4 md:w-5 md:h-5"}):a?(0,g.jsx)(p.o,{className:"w-4 h-4 md:w-5 md:h-5"}):"article"===e.type?(0,g.jsx)(r.n,{className:"w-4 h-4 md:w-5 md:h-5"}):"audio"===e.type?(0,g.jsx)(u.n,{className:"w-4 h-4 md:w-5 md:h-5"}):(0,g.jsx)(d.t,{className:"w-4 h-4 md:w-5 md:h-5"})}),(0,g.jsxs)("div",{className:"col-span-11 md:col-span-5 flex flex-col gap-1 min-w-0",children:[(0,g.jsx)("span",{className:"mono-ui text-[12px] md:text-[13px] font-bold truncate ".concat(a?"text-primary":s?"italic":"text-content"," group-hover:text-primary transition-colors"),children:e.title}),(0,g.jsx)("span",{className:"mono-ui text-[10px] md:text-[11px] truncate tracking-widest ".concat(a?"text-primary/70":"text-forest"),children:e.metadata})]}),(0,g.jsx)("div",{className:"col-span-2 hidden md:block text-right mono-ui text-[11px] md:text-[12px] ".concat(a?"text-primary":"text-forest"),children:H(e.duration)}),(0,g.jsx)("div",{className:"col-span-2 hidden md:block text-right mono-ui text-[11px] md:text-[12px] ".concat(a?"text-primary":"text-forest"),children:(l=e.size,0===l?"0 KB":l<1024?"".concat(l," B"):l<1048576?"".concat((l/1024).toFixed(1)," KB"):"".concat((l/1048576).toFixed(1)," MB"))}),(0,g.jsxs)("div",{className:"col-span-2 flex items-center justify-end gap-2 md:gap-3 ".concat(a?"":"opacity-0 group-hover:opacity-100"," transition-opacity"),children:[s?(0,g.jsx)("button",{className:"text-content hover:text-primary",children:(0,g.jsx)(i.o,{className:"w-4 h-4 md:w-5 md:h-5"})}):(0,g.jsx)("button",{onClick:()=>(async e=>{if((null===D||void 0===D?void 0:D.id)===e.id&&G)M();else if("article"===e.type)R({id:e.id,title:e.title,summary:e.narrative||e.summary||e.title});else{const t=await(0,v.zp)(e.id);null!==t&&void 0!==t&&t.audio_url&&R({id:e.id,title:e.title,audio_url:t.audio_url,isOffline:t.isOffline})}})(e),className:"".concat(a?"text-primary":"text-content"," hover:text-primary"),"data-testid":"play-cached-".concat(e.id),children:a?(0,g.jsx)(x.v,{className:"w-4 h-4 md:w-5 md:h-5"}):(0,g.jsx)(m.j,{className:"w-4 h-4 md:w-5 md:h-5",fill:"currentColor"})}),(0,g.jsx)("button",{onClick:()=>(async(e,t)=>{if("article"===t)try{await fetch("".concat(b,"/api/offline/articles/").concat(e),{method:"DELETE"}),await P(),await B()}catch(a){console.error("Error removing saved article:",a)}else await(0,v.dZ)(e),await F()})(e.id,e.type),className:"".concat(a?"text-primary/50":"text-content"," hover:text-primary"),"data-testid":"remove-cached-".concat(e.id),children:(0,g.jsx)(h.l,{className:"w-4 h-4"})})]})]},e.id);var l})})]}),!A&&U.length>0&&(0,g.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 pt-4 mono-ui text-[11px] md:text-[12px] text-forest font-bold",children:[(0,g.jsxs)("span",{children:["SHOWING: ",6*(T-1)+1,"-",Math.min(6*T,U.length)," ","// ","TOTAL: ",U.length,"_ITEMS"]}),(0,g.jsxs)("div",{className:"flex items-center gap-4 md:gap-6",children:[(0,g.jsx)("button",{onClick:()=>O(e=>Math.max(1,e-1)),disabled:1===T,className:1===T?"opacity-30 cursor-not-allowed":"hover:text-content transition-colors",children:"PREV_SIGNAL"}),(0,g.jsx)("div",{className:"flex gap-3 md:gap-4",children:Array.from({length:Y},(e,t)=>t+1).slice(0,3).map(e=>(0,g.jsx)("button",{onClick:()=>O(e),className:e===T?"text-primary underline underline-offset-4 decoration-2":"hover:text-content transition-colors",children:String(e).padStart(2,"0")},e))}),(0,g.jsx)("button",{onClick:()=>O(e=>Math.min(Y,e+1)),disabled:T===Y,className:T===Y?"opacity-30 cursor-not-allowed":"text-content hover:text-primary transition-colors",children:"NEXT_SIGNAL"})]})]})]})}}}]);
//# sourceMappingURL=127.3e93f6a0.chunk.js.map