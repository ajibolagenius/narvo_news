{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nconst API_URL = process.env.REACT_APP_BACKEND_URL || '';\nconst BOOKMARKS_KEY = 'narvo_bookmarks';\nexport const useBookmarks = () => {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const [bookmarks, setBookmarks] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const getLocalBookmarks = () => {\n    try {\n      return JSON.parse(localStorage.getItem(BOOKMARKS_KEY) || '[]');\n    } catch {\n      return [];\n    }\n  };\n  const saveLocalBookmarks = items => {\n    localStorage.setItem(BOOKMARKS_KEY, JSON.stringify(items));\n  };\n  const fetchBookmarks = useCallback(async () => {\n    if (!user) {\n      setBookmarks(getLocalBookmarks());\n      return;\n    }\n    setLoading(true);\n    try {\n      const res = await fetch(`${API_URL}/api/bookmarks?user_id=${user.id}`);\n      if (res.ok) {\n        const data = await res.json();\n        setBookmarks(data);\n        saveLocalBookmarks(data);\n      } else {\n        setBookmarks(getLocalBookmarks());\n      }\n    } catch {\n      setBookmarks(getLocalBookmarks());\n    }\n    setLoading(false);\n  }, [user]);\n  useEffect(() => {\n    fetchBookmarks();\n  }, [fetchBookmarks]);\n  const addBookmark = async story => {\n    const bookmark = {\n      story_id: story.id,\n      title: story.title,\n      summary: story.summary || '',\n      source: story.source || '',\n      category: story.category || 'General',\n      source_url: story.source_url || '',\n      saved_at: new Date().toISOString()\n    };\n    const updated = [...bookmarks.filter(b => b.story_id !== story.id), bookmark];\n    setBookmarks(updated);\n    saveLocalBookmarks(updated);\n    if (user) {\n      try {\n        await fetch(`${API_URL}/api/bookmarks`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            user_id: user.id,\n            ...bookmark\n          })\n        });\n      } catch (e) {\n        console.error('Failed to sync bookmark:', e);\n      }\n    }\n  };\n  const removeBookmark = async storyId => {\n    const updated = bookmarks.filter(b => b.story_id !== storyId);\n    setBookmarks(updated);\n    saveLocalBookmarks(updated);\n    if (user) {\n      try {\n        await fetch(`${API_URL}/api/bookmarks/${storyId}?user_id=${user.id}`, {\n          method: 'DELETE'\n        });\n      } catch (e) {\n        console.error('Failed to remove bookmark:', e);\n      }\n    }\n  };\n  const isBookmarked = storyId => bookmarks.some(b => b.story_id === storyId);\n  return {\n    bookmarks,\n    loading,\n    addBookmark,\n    removeBookmark,\n    isBookmarked,\n    fetchBookmarks\n  };\n};\n_s(useBookmarks, \"jVNfEN08Ie95UbItg3LtRR0yFMI=\", false, function () {\n  return [useAuth];\n});","map":{"version":3,"names":["useState","useEffect","useCallback","useAuth","API_URL","process","env","REACT_APP_BACKEND_URL","BOOKMARKS_KEY","useBookmarks","_s","user","bookmarks","setBookmarks","loading","setLoading","getLocalBookmarks","JSON","parse","localStorage","getItem","saveLocalBookmarks","items","setItem","stringify","fetchBookmarks","res","fetch","id","ok","data","json","addBookmark","story","bookmark","story_id","title","summary","source","category","source_url","saved_at","Date","toISOString","updated","filter","b","method","headers","body","user_id","e","console","error","removeBookmark","storyId","isBookmarked","some"],"sources":["/app/frontend/src/hooks/useBookmarks.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\n\nconst API_URL = process.env.REACT_APP_BACKEND_URL || '';\nconst BOOKMARKS_KEY = 'narvo_bookmarks';\n\nexport const useBookmarks = () => {\n  const { user } = useAuth();\n  const [bookmarks, setBookmarks] = useState([]);\n  const [loading, setLoading] = useState(false);\n\n  const getLocalBookmarks = () => {\n    try {\n      return JSON.parse(localStorage.getItem(BOOKMARKS_KEY) || '[]');\n    } catch { return []; }\n  };\n\n  const saveLocalBookmarks = (items) => {\n    localStorage.setItem(BOOKMARKS_KEY, JSON.stringify(items));\n  };\n\n  const fetchBookmarks = useCallback(async () => {\n    if (!user) {\n      setBookmarks(getLocalBookmarks());\n      return;\n    }\n    setLoading(true);\n    try {\n      const res = await fetch(`${API_URL}/api/bookmarks?user_id=${user.id}`);\n      if (res.ok) {\n        const data = await res.json();\n        setBookmarks(data);\n        saveLocalBookmarks(data);\n      } else {\n        setBookmarks(getLocalBookmarks());\n      }\n    } catch {\n      setBookmarks(getLocalBookmarks());\n    }\n    setLoading(false);\n  }, [user]);\n\n  useEffect(() => { fetchBookmarks(); }, [fetchBookmarks]);\n\n  const addBookmark = async (story) => {\n    const bookmark = {\n      story_id: story.id,\n      title: story.title,\n      summary: story.summary || '',\n      source: story.source || '',\n      category: story.category || 'General',\n      source_url: story.source_url || '',\n      saved_at: new Date().toISOString(),\n    };\n\n    const updated = [...bookmarks.filter(b => b.story_id !== story.id), bookmark];\n    setBookmarks(updated);\n    saveLocalBookmarks(updated);\n\n    if (user) {\n      try {\n        await fetch(`${API_URL}/api/bookmarks`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ user_id: user.id, ...bookmark }),\n        });\n      } catch (e) { console.error('Failed to sync bookmark:', e); }\n    }\n  };\n\n  const removeBookmark = async (storyId) => {\n    const updated = bookmarks.filter(b => b.story_id !== storyId);\n    setBookmarks(updated);\n    saveLocalBookmarks(updated);\n\n    if (user) {\n      try {\n        await fetch(`${API_URL}/api/bookmarks/${storyId}?user_id=${user.id}`, { method: 'DELETE' });\n      } catch (e) { console.error('Failed to remove bookmark:', e); }\n    }\n  };\n\n  const isBookmarked = (storyId) => bookmarks.some(b => b.story_id === storyId);\n\n  return { bookmarks, loading, addBookmark, removeBookmark, isBookmarked, fetchBookmarks };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}