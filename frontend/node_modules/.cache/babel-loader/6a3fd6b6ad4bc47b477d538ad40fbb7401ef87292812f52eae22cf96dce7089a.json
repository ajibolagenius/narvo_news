{"ast":null,"code":"const DB_NAME = 'narvo_audio_cache';\nconst STORE_NAME = 'audio_files';\nconst DB_VERSION = 1;\nfunction openDB() {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n    request.onupgradeneeded = e => {\n      const db = e.target.result;\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\n        db.createObjectStore(STORE_NAME, {\n          keyPath: 'story_id'\n        });\n      }\n    };\n    request.onsuccess = e => resolve(e.target.result);\n    request.onerror = e => reject(e.target.error);\n  });\n}\nexport async function cacheAudio(storyId, audioUrl) {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const store = tx.objectStore(STORE_NAME);\n    store.put({\n      story_id: storyId,\n      audio_url: audioUrl,\n      cached_at: new Date().toISOString()\n    });\n    return new Promise((resolve, reject) => {\n      tx.oncomplete = () => resolve(true);\n      tx.onerror = () => reject(tx.error);\n    });\n  } catch (e) {\n    console.error('Failed to cache audio:', e);\n    return false;\n  }\n}\nexport async function getCachedAudio(storyId) {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readonly');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.get(storyId);\n    return new Promise(resolve => {\n      request.onsuccess = () => {\n        var _request$result;\n        return resolve(((_request$result = request.result) === null || _request$result === void 0 ? void 0 : _request$result.audio_url) || null);\n      };\n      request.onerror = () => resolve(null);\n    });\n  } catch {\n    return null;\n  }\n}\nexport async function removeCachedAudio(storyId) {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const store = tx.objectStore(STORE_NAME);\n    store.delete(storyId);\n    return new Promise(resolve => {\n      tx.oncomplete = () => resolve(true);\n      tx.onerror = () => resolve(false);\n    });\n  } catch {\n    return false;\n  }\n}\nexport async function getAllCachedIds() {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readonly');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.getAllKeys();\n    return new Promise(resolve => {\n      request.onsuccess = () => resolve(request.result || []);\n      request.onerror = () => resolve([]);\n    });\n  } catch {\n    return [];\n  }\n}","map":{"version":3,"names":["DB_NAME","STORE_NAME","DB_VERSION","openDB","Promise","resolve","reject","request","indexedDB","open","onupgradeneeded","e","db","target","result","objectStoreNames","contains","createObjectStore","keyPath","onsuccess","onerror","error","cacheAudio","storyId","audioUrl","tx","transaction","store","objectStore","put","story_id","audio_url","cached_at","Date","toISOString","oncomplete","console","getCachedAudio","get","_request$result","removeCachedAudio","delete","getAllCachedIds","getAllKeys"],"sources":["/app/frontend/src/lib/audioCache.js"],"sourcesContent":["const DB_NAME = 'narvo_audio_cache';\nconst STORE_NAME = 'audio_files';\nconst DB_VERSION = 1;\n\nfunction openDB() {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n    request.onupgradeneeded = (e) => {\n      const db = e.target.result;\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\n        db.createObjectStore(STORE_NAME, { keyPath: 'story_id' });\n      }\n    };\n    request.onsuccess = (e) => resolve(e.target.result);\n    request.onerror = (e) => reject(e.target.error);\n  });\n}\n\nexport async function cacheAudio(storyId, audioUrl) {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const store = tx.objectStore(STORE_NAME);\n    store.put({ story_id: storyId, audio_url: audioUrl, cached_at: new Date().toISOString() });\n    return new Promise((resolve, reject) => {\n      tx.oncomplete = () => resolve(true);\n      tx.onerror = () => reject(tx.error);\n    });\n  } catch (e) {\n    console.error('Failed to cache audio:', e);\n    return false;\n  }\n}\n\nexport async function getCachedAudio(storyId) {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readonly');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.get(storyId);\n    return new Promise((resolve) => {\n      request.onsuccess = () => resolve(request.result?.audio_url || null);\n      request.onerror = () => resolve(null);\n    });\n  } catch {\n    return null;\n  }\n}\n\nexport async function removeCachedAudio(storyId) {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const store = tx.objectStore(STORE_NAME);\n    store.delete(storyId);\n    return new Promise((resolve) => {\n      tx.oncomplete = () => resolve(true);\n      tx.onerror = () => resolve(false);\n    });\n  } catch {\n    return false;\n  }\n}\n\nexport async function getAllCachedIds() {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readonly');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.getAllKeys();\n    return new Promise((resolve) => {\n      request.onsuccess = () => resolve(request.result || []);\n      request.onerror = () => resolve([]);\n    });\n  } catch {\n    return [];\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}