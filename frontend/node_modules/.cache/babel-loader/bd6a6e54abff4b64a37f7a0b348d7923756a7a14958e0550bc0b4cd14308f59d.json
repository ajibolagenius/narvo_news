{"ast":null,"code":"const DB_NAME='narvo_audio_cache';const STORE_NAME='audio_files';const DB_VERSION=1;function openDB(){return new Promise((resolve,reject)=>{const request=indexedDB.open(DB_NAME,DB_VERSION);request.onupgradeneeded=e=>{const db=e.target.result;if(!db.objectStoreNames.contains(STORE_NAME)){db.createObjectStore(STORE_NAME,{keyPath:'story_id'});}};request.onsuccess=e=>resolve(e.target.result);request.onerror=e=>reject(e.target.error);});}export async function cacheAudio(storyId,audioUrl){try{const db=await openDB();const tx=db.transaction(STORE_NAME,'readwrite');const store=tx.objectStore(STORE_NAME);store.put({story_id:storyId,audio_url:audioUrl,cached_at:new Date().toISOString()});return new Promise((resolve,reject)=>{tx.oncomplete=()=>resolve(true);tx.onerror=()=>reject(tx.error);});}catch(e){console.error('Failed to cache audio:',e);return false;}}export async function getCachedAudio(storyId){try{const db=await openDB();const tx=db.transaction(STORE_NAME,'readonly');const store=tx.objectStore(STORE_NAME);const request=store.get(storyId);return new Promise(resolve=>{request.onsuccess=()=>{var _request$result;return resolve(((_request$result=request.result)===null||_request$result===void 0?void 0:_request$result.audio_url)||null);};request.onerror=()=>resolve(null);});}catch(_unused){return null;}}export async function removeCachedAudio(storyId){try{const db=await openDB();const tx=db.transaction(STORE_NAME,'readwrite');const store=tx.objectStore(STORE_NAME);store.delete(storyId);return new Promise(resolve=>{tx.oncomplete=()=>resolve(true);tx.onerror=()=>resolve(false);});}catch(_unused2){return false;}}export async function getAllCachedIds(){try{const db=await openDB();const tx=db.transaction(STORE_NAME,'readonly');const store=tx.objectStore(STORE_NAME);const request=store.getAllKeys();return new Promise(resolve=>{request.onsuccess=()=>resolve(request.result||[]);request.onerror=()=>resolve([]);});}catch(_unused3){return[];}}","map":{"version":3,"names":["DB_NAME","STORE_NAME","DB_VERSION","openDB","Promise","resolve","reject","request","indexedDB","open","onupgradeneeded","e","db","target","result","objectStoreNames","contains","createObjectStore","keyPath","onsuccess","onerror","error","cacheAudio","storyId","audioUrl","tx","transaction","store","objectStore","put","story_id","audio_url","cached_at","Date","toISOString","oncomplete","console","getCachedAudio","get","_request$result","_unused","removeCachedAudio","delete","_unused2","getAllCachedIds","getAllKeys","_unused3"],"sources":["/app/frontend/src/lib/audioCache.js"],"sourcesContent":["const DB_NAME = 'narvo_audio_cache';\nconst STORE_NAME = 'audio_files';\nconst DB_VERSION = 1;\n\nfunction openDB() {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n    request.onupgradeneeded = (e) => {\n      const db = e.target.result;\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\n        db.createObjectStore(STORE_NAME, { keyPath: 'story_id' });\n      }\n    };\n    request.onsuccess = (e) => resolve(e.target.result);\n    request.onerror = (e) => reject(e.target.error);\n  });\n}\n\nexport async function cacheAudio(storyId, audioUrl) {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const store = tx.objectStore(STORE_NAME);\n    store.put({ story_id: storyId, audio_url: audioUrl, cached_at: new Date().toISOString() });\n    return new Promise((resolve, reject) => {\n      tx.oncomplete = () => resolve(true);\n      tx.onerror = () => reject(tx.error);\n    });\n  } catch (e) {\n    console.error('Failed to cache audio:', e);\n    return false;\n  }\n}\n\nexport async function getCachedAudio(storyId) {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readonly');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.get(storyId);\n    return new Promise((resolve) => {\n      request.onsuccess = () => resolve(request.result?.audio_url || null);\n      request.onerror = () => resolve(null);\n    });\n  } catch {\n    return null;\n  }\n}\n\nexport async function removeCachedAudio(storyId) {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readwrite');\n    const store = tx.objectStore(STORE_NAME);\n    store.delete(storyId);\n    return new Promise((resolve) => {\n      tx.oncomplete = () => resolve(true);\n      tx.onerror = () => resolve(false);\n    });\n  } catch {\n    return false;\n  }\n}\n\nexport async function getAllCachedIds() {\n  try {\n    const db = await openDB();\n    const tx = db.transaction(STORE_NAME, 'readonly');\n    const store = tx.objectStore(STORE_NAME);\n    const request = store.getAllKeys();\n    return new Promise((resolve) => {\n      request.onsuccess = () => resolve(request.result || []);\n      request.onerror = () => resolve([]);\n    });\n  } catch {\n    return [];\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}