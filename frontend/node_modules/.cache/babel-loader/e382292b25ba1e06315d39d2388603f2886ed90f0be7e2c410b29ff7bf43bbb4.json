{"ast":null,"code":"import _objectSpread from\"/app/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect,useCallback}from'react';import{useAuth}from'../contexts/AuthContext';const API_URL=process.env.REACT_APP_BACKEND_URL||'';const BOOKMARKS_KEY='narvo_bookmarks';export const useBookmarks=()=>{const{user}=useAuth();const[bookmarks,setBookmarks]=useState([]);const[loading,setLoading]=useState(false);const getLocalBookmarks=()=>{try{return JSON.parse(localStorage.getItem(BOOKMARKS_KEY)||'[]');}catch(_unused){return[];}};const saveLocalBookmarks=items=>{localStorage.setItem(BOOKMARKS_KEY,JSON.stringify(items));};const fetchBookmarks=useCallback(async()=>{if(!user){setBookmarks(getLocalBookmarks());return;}setLoading(true);try{const res=await fetch(\"\".concat(API_URL,\"/api/bookmarks?user_id=\").concat(user.id));if(res.ok){const data=await res.json();setBookmarks(data);saveLocalBookmarks(data);}else{setBookmarks(getLocalBookmarks());}}catch(_unused2){setBookmarks(getLocalBookmarks());}setLoading(false);},[user]);useEffect(()=>{fetchBookmarks();},[fetchBookmarks]);const addBookmark=async story=>{const bookmark={story_id:story.id,title:story.title,summary:story.summary||'',source:story.source||'',category:story.category||'General',source_url:story.source_url||'',saved_at:new Date().toISOString()};const updated=[...bookmarks.filter(b=>b.story_id!==story.id),bookmark];setBookmarks(updated);saveLocalBookmarks(updated);if(user){try{await fetch(\"\".concat(API_URL,\"/api/bookmarks\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(_objectSpread({user_id:user.id},bookmark))});}catch(e){console.error('Failed to sync bookmark:',e);}}};const removeBookmark=async storyId=>{const updated=bookmarks.filter(b=>b.story_id!==storyId);setBookmarks(updated);saveLocalBookmarks(updated);if(user){try{await fetch(\"\".concat(API_URL,\"/api/bookmarks/\").concat(storyId,\"?user_id=\").concat(user.id),{method:'DELETE'});}catch(e){console.error('Failed to remove bookmark:',e);}}};const isBookmarked=storyId=>bookmarks.some(b=>b.story_id===storyId);return{bookmarks,loading,addBookmark,removeBookmark,isBookmarked,fetchBookmarks};};","map":{"version":3,"names":["useState","useEffect","useCallback","useAuth","API_URL","process","env","REACT_APP_BACKEND_URL","BOOKMARKS_KEY","useBookmarks","user","bookmarks","setBookmarks","loading","setLoading","getLocalBookmarks","JSON","parse","localStorage","getItem","_unused","saveLocalBookmarks","items","setItem","stringify","fetchBookmarks","res","fetch","concat","id","ok","data","json","_unused2","addBookmark","story","bookmark","story_id","title","summary","source","category","source_url","saved_at","Date","toISOString","updated","filter","b","method","headers","body","_objectSpread","user_id","e","console","error","removeBookmark","storyId","isBookmarked","some"],"sources":["/app/frontend/src/hooks/useBookmarks.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\n\nconst API_URL = process.env.REACT_APP_BACKEND_URL || '';\nconst BOOKMARKS_KEY = 'narvo_bookmarks';\n\nexport const useBookmarks = () => {\n  const { user } = useAuth();\n  const [bookmarks, setBookmarks] = useState([]);\n  const [loading, setLoading] = useState(false);\n\n  const getLocalBookmarks = () => {\n    try {\n      return JSON.parse(localStorage.getItem(BOOKMARKS_KEY) || '[]');\n    } catch { return []; }\n  };\n\n  const saveLocalBookmarks = (items) => {\n    localStorage.setItem(BOOKMARKS_KEY, JSON.stringify(items));\n  };\n\n  const fetchBookmarks = useCallback(async () => {\n    if (!user) {\n      setBookmarks(getLocalBookmarks());\n      return;\n    }\n    setLoading(true);\n    try {\n      const res = await fetch(`${API_URL}/api/bookmarks?user_id=${user.id}`);\n      if (res.ok) {\n        const data = await res.json();\n        setBookmarks(data);\n        saveLocalBookmarks(data);\n      } else {\n        setBookmarks(getLocalBookmarks());\n      }\n    } catch {\n      setBookmarks(getLocalBookmarks());\n    }\n    setLoading(false);\n  }, [user]);\n\n  useEffect(() => { fetchBookmarks(); }, [fetchBookmarks]);\n\n  const addBookmark = async (story) => {\n    const bookmark = {\n      story_id: story.id,\n      title: story.title,\n      summary: story.summary || '',\n      source: story.source || '',\n      category: story.category || 'General',\n      source_url: story.source_url || '',\n      saved_at: new Date().toISOString(),\n    };\n\n    const updated = [...bookmarks.filter(b => b.story_id !== story.id), bookmark];\n    setBookmarks(updated);\n    saveLocalBookmarks(updated);\n\n    if (user) {\n      try {\n        await fetch(`${API_URL}/api/bookmarks`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ user_id: user.id, ...bookmark }),\n        });\n      } catch (e) { console.error('Failed to sync bookmark:', e); }\n    }\n  };\n\n  const removeBookmark = async (storyId) => {\n    const updated = bookmarks.filter(b => b.story_id !== storyId);\n    setBookmarks(updated);\n    saveLocalBookmarks(updated);\n\n    if (user) {\n      try {\n        await fetch(`${API_URL}/api/bookmarks/${storyId}?user_id=${user.id}`, { method: 'DELETE' });\n      } catch (e) { console.error('Failed to remove bookmark:', e); }\n    }\n  };\n\n  const isBookmarked = (storyId) => bookmarks.some(b => b.story_id === storyId);\n\n  return { bookmarks, loading, addBookmark, removeBookmark, isBookmarked, fetchBookmarks };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}