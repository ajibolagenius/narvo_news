{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{cacheAudio,getCachedAudio}from'../lib/audioCache';import{jsx as _jsx}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_BACKEND_URL||'';const AudioContext=/*#__PURE__*/createContext();export const useAudio=()=>useContext(AudioContext);export const AudioProvider=_ref=>{let{children}=_ref;const[currentTrack,setCurrentTrack]=useState(null);const[isPlaying,setIsPlaying]=useState(false);const[audioElement,setAudioElement]=useState(null);const[progress,setProgress]=useState(0);const[duration,setDuration]=useState(0);const[volume,setVolume]=useState(0.8);const[isLoading,setIsLoading]=useState(false);useEffect(()=>{const audio=new Audio();audio.volume=0.8;audio.addEventListener('timeupdate',()=>setProgress(audio.currentTime));audio.addEventListener('loadedmetadata',()=>{setDuration(audio.duration);setIsLoading(false);});audio.addEventListener('ended',()=>{setIsPlaying(false);setProgress(0);});audio.addEventListener('error',()=>{setIsLoading(false);setIsPlaying(false);});setAudioElement(audio);return()=>{audio.pause();audio.src='';};},[]);const playTrack=async track=>{if(!audioElement)return;setIsLoading(true);setCurrentTrack(track);// Check cached audio first\nconst cachedUrl=await getCachedAudio(track.id);if(cachedUrl){audioElement.src=cachedUrl;await audioElement.play();setIsPlaying(true);return;}if(track.audio_url){audioElement.src=track.audio_url;await audioElement.play();setIsPlaying(true);// Cache for offline\ncacheAudio(track.id,track.audio_url);}else{try{const response=await fetch(\"\".concat(API_URL,\"/api/tts/generate\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:track.narrative||track.summary||track.title,voice_id:track.voice_id||'nova'})});if(response.ok){const data=await response.json();audioElement.src=data.audio_url;await audioElement.play();setIsPlaying(true);track.audio_url=data.audio_url;// Cache for offline\ncacheAudio(track.id,data.audio_url);}}catch(error){console.error('TTS error:',error);setIsLoading(false);}}};const togglePlay=()=>{if(!audioElement)return;if(isPlaying)audioElement.pause();else audioElement.play();setIsPlaying(!isPlaying);};const seek=time=>{if(audioElement){audioElement.currentTime=time;setProgress(time);}};const setVolumeLevel=level=>{setVolume(level);if(audioElement)audioElement.volume=level;};return/*#__PURE__*/_jsx(AudioContext.Provider,{value:{currentTrack,isPlaying,progress,duration,volume,isLoading,playTrack,togglePlay,seek,setVolumeLevel},children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","cacheAudio","getCachedAudio","jsx","_jsx","API_URL","process","env","REACT_APP_BACKEND_URL","AudioContext","useAudio","AudioProvider","_ref","children","currentTrack","setCurrentTrack","isPlaying","setIsPlaying","audioElement","setAudioElement","progress","setProgress","duration","setDuration","volume","setVolume","isLoading","setIsLoading","audio","Audio","addEventListener","currentTime","pause","src","playTrack","track","cachedUrl","id","play","audio_url","response","fetch","concat","method","headers","body","JSON","stringify","text","narrative","summary","title","voice_id","ok","data","json","error","console","togglePlay","seek","time","setVolumeLevel","level","Provider","value"],"sources":["/app/frontend/src/contexts/AudioContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport { cacheAudio, getCachedAudio } from '../lib/audioCache';\n\nconst API_URL = process.env.REACT_APP_BACKEND_URL || '';\n\nconst AudioContext = createContext();\n\nexport const useAudio = () => useContext(AudioContext);\n\nexport const AudioProvider = ({ children }) => {\n  const [currentTrack, setCurrentTrack] = useState(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [audioElement, setAudioElement] = useState(null);\n  const [progress, setProgress] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [volume, setVolume] = useState(0.8);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    const audio = new Audio();\n    audio.volume = 0.8;\n    audio.addEventListener('timeupdate', () => setProgress(audio.currentTime));\n    audio.addEventListener('loadedmetadata', () => { setDuration(audio.duration); setIsLoading(false); });\n    audio.addEventListener('ended', () => { setIsPlaying(false); setProgress(0); });\n    audio.addEventListener('error', () => { setIsLoading(false); setIsPlaying(false); });\n    setAudioElement(audio);\n    return () => { audio.pause(); audio.src = ''; };\n  }, []);\n\n  const playTrack = async (track) => {\n    if (!audioElement) return;\n    setIsLoading(true);\n    setCurrentTrack(track);\n\n    // Check cached audio first\n    const cachedUrl = await getCachedAudio(track.id);\n    if (cachedUrl) {\n      audioElement.src = cachedUrl;\n      await audioElement.play();\n      setIsPlaying(true);\n      return;\n    }\n\n    if (track.audio_url) {\n      audioElement.src = track.audio_url;\n      await audioElement.play();\n      setIsPlaying(true);\n      // Cache for offline\n      cacheAudio(track.id, track.audio_url);\n    } else {\n      try {\n        const response = await fetch(`${API_URL}/api/tts/generate`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ text: track.narrative || track.summary || track.title, voice_id: track.voice_id || 'nova' })\n        });\n        if (response.ok) {\n          const data = await response.json();\n          audioElement.src = data.audio_url;\n          await audioElement.play();\n          setIsPlaying(true);\n          track.audio_url = data.audio_url;\n          // Cache for offline\n          cacheAudio(track.id, data.audio_url);\n        }\n      } catch (error) { console.error('TTS error:', error); setIsLoading(false); }\n    }\n  };\n\n  const togglePlay = () => {\n    if (!audioElement) return;\n    if (isPlaying) audioElement.pause(); else audioElement.play();\n    setIsPlaying(!isPlaying);\n  };\n\n  const seek = (time) => { if (audioElement) { audioElement.currentTime = time; setProgress(time); } };\n  const setVolumeLevel = (level) => { setVolume(level); if (audioElement) audioElement.volume = level; };\n\n  return (\n    <AudioContext.Provider value={{ currentTrack, isPlaying, progress, duration, volume, isLoading, playTrack, togglePlay, seek, setVolumeLevel }}>\n      {children}\n    </AudioContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}